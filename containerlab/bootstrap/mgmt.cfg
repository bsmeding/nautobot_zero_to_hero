# Bootstrap configuration for mgmt (Alpine Linux)
# Management server configuration

# Configure management interface (eth0)
cat > /etc/network/interfaces << EOF
auto lo
iface lo inet loopback

auto eth0
iface eth0 inet static
    address 172.20.20.16
    netmask 255.255.255.0
    gateway 172.20.20.1

auto eth1
iface eth1 inet static
    address 10.0.0.16
    netmask 255.255.255.0
EOF

# Configure data interface (eth1)
# eth1 will be used for management server connections

# Set root password
echo "root:root" | chpasswd

# Enable SSH
apk add --no-cache openssh
ssh-keygen -A
rc-update add sshd default

# Install network management tools
apk add --no-cache curl wget net-tools tcpdump nmap iperf3

# Install Python and pip for automation (commented out for faster startup)
# apk add python3 py3-pip
# pip3 install requests paramiko napalm

# Create management directory structure
mkdir -p /opt/management/{scripts,configs,logs}

# Set up basic logging
echo "Management server initialized at $(date)" > /var/log/management.log

# Enable network interfaces
ifup eth0
ifup eth1

echo "Management server bootstrap completed"

# Start SSH daemon (must be last command)
/usr/sbin/sshd -D
