# Design Builder Configuration matching Preflight Job
# Using !create_or_update to handle existing objects

---
# Location Types (created first as per preflight job)
location_types:
  - "!create_or_update:name": "Region"
    nestable: false
    description: "Geographic regions"
  - "!create_or_update:name": "Site"
    nestable: true
    parent__name: "Region"
    description: "Physical sites and data centers"
    content_types:
      - "!get:app_label": "circuits"
        "!get:model": "circuit"
      - "!get:app_label": "circuits"
        "!get:model": "circuittermination"
      - "!get:app_label": "dcim"
        "!get:model": "device"
      - "!get:app_label": "dcim"
        "!get:model": "powerpanel"
      - "!get:app_label": "dcim"
        "!get:model": "rack"
      - "!get:app_label": "ipam"
        "!get:model": "prefix"
      - "!get:app_label": "ipam"
        "!get:model": "vlan"
      - "!get:app_label": "ipam"
        "!get:model": "vlangroup"
  - "!create_or_update:name": "Building"
    nestable: true
    parent__name: "Site"
    description: "Buildings within sites"
    content_types:
      - "!get:app_label": "circuits"
        "!get:model": "circuittermination"
      - "!get:app_label": "dcim"
        "!get:model": "device"
      - "!get:app_label": "dcim"
        "!get:model": "powerpanel"
      - "!get:app_label": "dcim"
        "!get:model": "rack"
  - "!create_or_update:name": "Floor"
    nestable: true
    parent__name: "Building"
    description: "Floors within buildings"
    content_types:
      - "!get:app_label": "dcim"
        "!get:model": "device"
      - "!get:app_label": "dcim"
        "!get:model": "powerpanel"
      - "!get:app_label": "dcim"
        "!get:model": "rack"

  - "!create_or_update:name": "Room"
    nestable: true
    parent__name: "Floor"
    description: "Rooms within floors"
    content_types:
      - "!get:app_label": "dcim"
        "!get:model": "device"
      - "!get:app_label": "dcim"
        "!get:model": "powerpanel"
      - "!get:app_label": "dcim"
        "!get:model": "rack"

# Locations (created after location types)
locations:
  - "!create_or_update:name": "NetDevOps"
    location_type__name: "Region"
    status__name: "Active"
    description: "NetDevOps Lab Region"
  - "!create_or_update:name": "netdevops.it_lab"
    location_type__name: "Site"
    parent__name: "NetDevOps"
    status__name: "Active"
    description: "Containerlab demo lab environment for network automation testing and blog series"

# Manufacturers (created first as per preflight job)
manufacturers:
  - "!create_or_update:name": "Arista"
    description: "Arista Networks"
  - "!create_or_update:name": "Nokia"
    description: "Nokia Networks"
  - "!create_or_update:name": "Generic"
    description: "Generic"

# Device Types (created after manufacturers)
device_types:
  - "!create_or_update:manufacturer__name": "Arista"
    "!create_or_update:model": "cEOS"
    u_height: 1
    is_full_depth: true
  - "!create_or_update:manufacturer__name": "Nokia"
    "!create_or_update:model": "SR Linux"
    u_height: 1
    is_full_depth: true
  - "!create_or_update:manufacturer__name": "Generic"
    "!create_or_update:model": "Alpine Linux"
    u_height: 1
    is_full_depth: true

# Platforms
platforms:
  - "!create_or_update:name": "Arista EOS"
    napalm_driver: "eos"
    network_driver: "arista_eos"
    description: "Arista EOS platform"
  - "!create_or_update:name": "Nokia SR Linux"
    napalm_driver: "srl"
    network_driver: "nokia_srl"
    description: "Nokia SR Linux platform"
  - "!create_or_update:name": "Alpine Linux"
    napalm_driver: "linux"
    network_driver: "linux"
    description: "Alpine Linux platform"

# Roles
roles:
  - "!create_or_update:name": "Access Switch"
    color: "28a745"
    description: "Access layer switches"
    content_types:
      - "!get:app_label": "dcim"
        "!get:model": "device"
  - "!create_or_update:name": "Distribution Switch"
    color: "fd7e14"
    description: "Distribution layer switches"
    content_types:
      - "!get:app_label": "dcim"
        "!get:model": "device"
  - "!create_or_update:name": "Router"
    color: "dc3545"
    description: "Core routers"
    content_types:
      - "!get:app_label": "dcim"
        "!get:model": "device"
  - "!create_or_update:name": "Server"
    color: "007bff"
    description: "Server devices"
    content_types:
      - "!get:app_label": "dcim"
        "!get:model": "device"
  - "!create_or_update:name": "Management"
    content_types:
      - "!get:app_label": "dcim"
        "!get:model": "device"
    color: "6f42c1"
    description: "Management devices"
  - "!create_or_update:name": "ZTP Server"
    content_types:
      - "!get:app_label": "virtualization"
        "!get:model": "virtualmachine"
    description: "ZTP server devices"
  - "!create_or_update:name": "Management Server"
    content_types:
      - "!get:app_label": "virtualization"
        "!get:model": "virtualmachine"
    description: "Management server devices"

# Tags
tags:
  - "!create_or_update:name": "lab"
    color: "007bff"
    description: "Lab environment"
  - "!create_or_update:name": "containerlab"
    color: "28a745"
    description: "Containerlab environment"
  - "!create_or_update:name": "automation"
    color: "fd7e14"
    description: "Automation environment"
  - "!create_or_update:name": "demo"
    color: "6f42c1"
    description: "Demo environment"
  - "!create_or_update:name": "blog-series"
    color: "17a2b8"
    description: "Blog series demo"

# VLANs
vlans:
  - "!create_or_update:vid": 10
    "!create_or_update:name": "Management"
    status__name: "Active"
  - "!create_or_update:vid": 20
    "!create_or_update:name": "Data"
    status__name: "Active"
  - "!create_or_update:vid": 30
    "!create_or_update:name": "Voice"
    status__name: "Active"
  - "!create_or_update:vid": 100
    "!create_or_update:name": "Lab-Network"
    status__name: "Active"
  - "!create_or_update:vid": 200
    "!create_or_update:name": "Automation"
    status__name: "Active"
  - "!create_or_update:vid": 300
    "!create_or_update:name": "Testing"
    status__name: "Active"

# VLAN Groups - NOT USED (keeping VLANs simple and global)

# Prefixes (created before devices)
# RIRs
rirs:
  - "!create_or_update:name": "ARIN"
    description: "American Registry for Internet Numbers"
    is_private: false
  - "!create_or_update:name": "RIPE NCC"
    description: "RIPE Network Coordination Centre"
    is_private: false
  - "!create_or_update:name": "APNIC"
    description: "Asia Pacific Network Information Centre"
    is_private: false
  - "!create_or_update:name": "LACNIC"
    description: "Latin America and Caribbean Network Information Centre"
    is_private: false
  - "!create_or_update:name": "AfriNIC"
    description: "African Network Information Centre"
    is_private: false
  - "!create_or_update:name": "RFC 1918"
    description: "Private address space as defined by RFC 1918"
    is_private: true
  - "!create_or_update:name": "RFC 4193"
    description: "Unique Local Addresses as defined by RFC 4193"
    is_private: true
  - "!create_or_update:name": "RFC 6598"
    description: "Shared Address Space as defined by RFC 6598"
    is_private: true
  - "!create_or_update:name": "RFC 3927"
    description: "Link-Local Addresses as defined by RFC 3927"
    is_private: true

prefixes:
  # Basic container prefixes - no namespace references for now
  - "!create_or_update:prefix": "172.20.0.0/16"
    type: "container"
    status__name: "Active"
    description: "Container for Management network"
    rir__name: "RFC 1918"
    date_allocated: "2025-01-01"
  - "!create_or_update:prefix": "172.16.0.0/12"
    type: "container"
    status__name: "Active"
    description: "Container for Voice network"
    rir__name: "RFC 1918"
    date_allocated: "2025-01-01"
  - "!create_or_update:prefix": "192.168.0.0/16"
    type: "container"
    status__name: "Active"
    description: "Container for Data networks"
    rir__name: "RFC 1918"
    date_allocated: "2025-01-01"


# Rack Groups (created before racks) - COMMENTED OUT (VALIDATION ERROR)
# rack_groups:
#   - "!create_or_update:name": "Lab Rack Group"
#     description: "Rack group for lab equipment"

# Racks (created before devices) - RE-ENABLED FOR TESTING (FIXED CONTENT_TYPES)
racks:
  - "!create_or_update:name": "Rack-01"
    location__name: "netdevops.it_lab"
    # "!ref": "rack1"
    status__name: "Active"
    u_height: 42
  - "!create_or_update:name": "Rack-02"
    location__name: "netdevops.it_lab"
    # "!ref": "rack2"
    status__name: "Active"
    u_height: 42


# Devices (created last as per preflight job) - RE-ENABLED FOR TESTING (WITH RACKS)
devices:
  - "!create_or_update:name": "access1"
    location__name: "netdevops.it_lab"
    role__name: "Access Switch"
    device_type__manufacturer__name: "Arista"
    device_type__model: "cEOS"
    platform__name: "Arista EOS"
    rack__name: "Rack-02"
    position: 11
    face: "front"
    status__name: "Active"
    # Note: Interfaces and IP addresses are handled by Preflight Job to avoid conflicts

  - "!create_or_update:name": "access2"
    location__name: "netdevops.it_lab"
    role__name: "Access Switch"
    device_type__manufacturer__name: "Arista"
    device_type__model: "cEOS"
    platform__name: "Arista EOS"
    rack__name: "Rack-02"
    position: 12
    face: "front"
    status__name: "Active"
    # Note: Interfaces and IP addresses are handled by Preflight Job to avoid conflicts

  - "!create_or_update:name": "dist1"
    location__name: "netdevops.it_lab"
    role__name: "Distribution Switch"
    device_type__manufacturer__name: "Nokia"
    device_type__model: "SR Linux"
    platform__name: "Nokia SR Linux"
    rack__name: "Rack-01"
    position: 15
    face: "front"
    status__name: "Active"
    # Note: Interfaces and IP addresses are handled by Preflight Job to avoid conflicts

  - "!create_or_update:name": "rtr1"
    location__name: "netdevops.it_lab"
    role__name: "Router"
    device_type__manufacturer__name: "Nokia"
    device_type__model: "SR Linux"
    platform__name: "Nokia SR Linux"
    rack__name: "Rack-01"
    position: 20
    face: "front"
    status__name: "Active"
    # Note: Interfaces and IP addresses are handled by Preflight Job to avoid conflicts


# Cluster Types (must be created first)
cluster_types:
  - "!create_or_update:name": "Containerlab"
    description: "Containerlab cluster"

# Cluster Groups
cluster_groups:
  - "!create_or_update:name": "Lab-Cluster-Group"
    description: "Lab cluster group"

# Clusters
clusters:
  - "!create_or_update:name": "Lab-Cluster"
    cluster_type__name: "Containerlab"
    cluster_group__name: "Lab-Cluster-Group"

# # IP Addresses for Virtual Machines and Devices
ip_addresses:
  # Device IP addresses with DNS names
  - "!create_or_update:address": "172.20.20.11/24"
    status__name: "Active"
    dns_name: "access1.lab"
    description: "Primary IP for access1"
  - "!create_or_update:address": "172.20.20.12/24"
    status__name: "Active"
    dns_name: "access2.lab"
    description: "Primary IP for access2"
  - "!create_or_update:address": "172.20.20.13/24"
    status__name: "Active"
    dns_name: "dist1.lab"
    description: "Primary IP for dist1"
  - "!create_or_update:address": "172.20.20.14/24"
    status__name: "Active"
    dns_name: "rtr1.lab"
    description: "Primary IP for rtr1"
  # VM IP addresses with DNS names
  - "!create_or_update:address": "172.20.20.15/24"
    status__name: "Active"
    dns_name: "ztp.lab"
    description: "Primary IP for ztp VM"
  - "!create_or_update:address": "172.20.20.16/24"
    status__name: "Active"
    dns_name: "mgmt.lab"
    description: "Primary IP for mgmt VM"

# Virtual Machines
virtual_machines:
  - "!create_or_update:name": "ztp"
    cluster__name: "Lab-Cluster"
    status__name: "Active"
  - "!create_or_update:name": "management"
    cluster__name: "Lab-Cluster"
    status__name: "Active"


# # Cable Types
# cable_types:
#   - "!create_or_update:name": "Cat6"
#     description: "Cat6 Ethernet cable"

# # Cable Connections
# cables:
#   # Access switches to Distribution switch
#   - "!create_or_update:termination_a__device__name": "access1"
#     "!create_or_update:termination_a__name": "Ethernet1"
#     "!create_or_update:termination_b__device__name": "dist1"
#     "!create_or_update:termination_b__name": "ethernet-1/1"
#     type__name: "Cat6"
#     status__name: "Active"
#     label: "access1-Ethernet1 to dist1-ethernet-1/1"
#   - "!create_or_update:termination_a__device__name": "access2"
#     "!create_or_update:termination_a__name": "Ethernet1"
#     "!create_or_update:termination_b__device__name": "dist1"
#     "!create_or_update:termination_b__name": "ethernet-1/2"
#     type__name: "Cat6"
#     status__name: "Active"
#     label: "access2-Ethernet1 to dist1-ethernet-1/2"
  
#   # Distribution switch to Router
#   - "!create_or_update:termination_a__device__name": "dist1"
#     "!create_or_update:termination_a__name": "ethernet-1/3"
#     "!create_or_update:termination_b__device__name": "rtr1"
#     "!create_or_update:termination_b__name": "ethernet-1/1"
#     type__name: "Cat6"
#     status__name: "Active"
#     label: "dist1-ethernet-1/3 to rtr1-ethernet-1/1"
  
#   # Router to VMs
#   - "!create_or_update:termination_a__device__name": "rtr1"
#     "!create_or_update:termination_a__name": "ethernet-1/2"
#     "!create_or_update:termination_b__virtual_machine__name": "ztp"
#     "!create_or_update:termination_b__name": "eth1"
#     type__name: "Cat6"
#     status__name: "Active"
#     label: "rtr1-ethernet-1/2 to ztp-eth1"
#   - "!create_or_update:termination_a__device__name": "rtr1"
#     "!create_or_update:termination_a__name": "ethernet-1/3"
#     "!create_or_update:termination_b__virtual_machine__name": "management"
#     "!create_or_update:termination_b__name": "eth1"
#     type__name: "Cat6"
#     status__name: "Active"
#     label: "rtr1-ethernet-1/3 to management-eth1"

# Config Contexts - Common and Platform-Specific Configurations
config_contexts:
  # Common configuration for all lab devices
  - "!create_or_update:name": "Lab Common Configuration"
    weight: 1000
    description: "Common configuration for all lab devices"
    is_active: true
    data:
      ntp_servers:
        - "192.168.1.1"
        - "192.168.1.2"
        - "time.google.com"
      dns_servers:
        - "8.8.8.8"
        - "8.8.4.4"
        - "1.1.1.1"
      syslog_hosts:
        - host: "192.168.1.100"
          port: 514
        - host: "192.168.1.101"
          port: 514
      snmp:
        community: "nautobot_lab_ro"
        location: "NetDevOps Lab"
      timezone: "UTC"
      domain_name: "netdevops.lab"
    locations:
      - "!get:name": "netdevops.it_lab"

  # Arista Platform-specific configuration
  - "!create_or_update:name": "Arista Platform Configuration"
    weight: 2000
    description: "Platform-specific configuration for Arista EOS devices"
    is_active: true
    data:
      platform_specific:
        cli_commands:
          save_config: "write memory"
          show_version: "show version"
        management_interface: "Management0"
        ntp_source_interface: "Management0"
        logging:
          buffer_size: 16384
          source_interface: "Management0"
        banner:
          motd: "Arista Device - NetDevOps Lab - Unauthorized access prohibited"
      features:
        lldp: true
        stp: "rapid-pvst"
    platforms:
      - "!get:name": "Arista EOS"
    locations:
      - "!get:name": "netdevops.it_lab"

  # Nokia Platform-specific configuration
  - "!create_or_update:name": "Nokia Platform Configuration"
    weight: 2000
    description: "Platform-specific configuration for Nokia SR Linux devices"
    is_active: true
    data:
      platform_specific:
        cli_commands:
          save_config: "tools system configuration save"
          show_version: "info system version"
        management_interface: "mgmt0"
        ntp_source_interface: "mgmt0"
        logging:
          buffer_size: 10000
          source_interface: "mgmt0"
        banner:
          motd: "Nokia SR Linux Device - NetDevOps Lab - Unauthorized access prohibited"
      features:
        lldp: true
        spanning_tree: "mstp"
    platforms:
      - "!get:name": "Nokia SR Linux"
    locations:
      - "!get:name": "netdevops.it_lab"

  # Role-specific configuration for Access Switches
  - "!create_or_update:name": "Access Switch Role Configuration"
    weight: 3000
    description: "Role-specific configuration for access switches"
    is_active: true
    data:
      role_specific:
        port_security:
          enabled: true
          max_mac_addresses: 2
        default_vlan: 100
        allowed_vlans: [10, 20, 30, 100, 200, 300]
        stp_portfast: true
    roles:
      - "!get:name": "Access Switch"
    locations:
      - "!get:name": "netdevops.it_lab"

